<html>
    <head>
{{>styleing}}

</head>
<body>
  
    {{>admin_header}}
    <div id="main-content">
          
        <div class="container-fluid">
            <div class="row">
               
                <div class="col-md-12">
                  <!-- post-container -->
                  
                    <div class="post-container">
                         <h4>{{shopname}}</h4>

                           

                            <h4 style="text-align: center;">view Products</h4>
                    <hr>
                    <div id='product-table'>

                    </div>
                               
                        
                          
                            
                        </div>
                    
                    <!-- /post-container -->
                </div>
               
            </div>
        </div>
    </div>
    <script src='./jquery.min.js'></script>
    <script>
        $(document).ready(function(){
            let c=1;
            const loadproducts=()=>{
                $.ajax({
                 url:'/show-products',
                 type:'POST',
                 success:function(data){
  
                    let output="<table id='description-table'style='margin:auto;'><tr><th>Sr No</th><th>Product Name</th><th>view</th></tr>";
                     data.forEach(element=>{
                          
                    output=output.concat(`<tr>
                                        <td>${c}</td>
                                        <td>${element.productname}</td>
                                        <td><a href="/category?id=${element._id}">View</a>
                                             <a href="#" id="delete" data-id=${element._id}>Del</a>    
                                        </td>
                                    </tr>`);
                                    c++;
                     })
                    output=output.concat('</table>');
                    
                   $('#product-table').html(output);  
                 }
                });
            }
            loadproducts();
           $('#add-product').click(function(e){
               e.preventDefault();
            let products=$('#products').val();
            if(products==''){
                $('#error').text('Enter The value');
                return;
            }
                 $.ajax({
                   url:'/add-products',
                   type:'POST',
                   data:{products},
                   success:function(data){
                     if(data){
                     loadproducts();
                     }
                  
                     $('#products').val('');
                   }
                 });
             }); 
        $(document).on('click','#delete',function(){
           let id=$(this).data('id');
          let ans= confirm('Are You sure you want to delete this item?');
             if(ans==true){
             $.ajax({
                 url:'/delete-product',
                 type:'POST',
                 data:{id},
                 success:function(data){
                  if(data==1){
                  loadproducts();
                   }
                 }
             })
             }

        }); 
        
        $('#search-input').keyup(function(){
            c=1;
            let value=$(this).val();
        
            $.ajax({
             url:'/search-product',
             type:'POST',
             data:{value},
             success:function(data){
                     let output="<table id='description-table'style='margin:auto;'><tr><th>Sr No</th><th>Product Name</th><th>view</th></tr>";
                     data.forEach(element=>{
                          
                    output=output.concat(`<tr>
                                        <td>${c}</td>
                                        <td>${element.productname}</td>
                                        <td><a href="/category?id=${element._id}">View</a>
                                             <a href="#" id="delete" data-id=${element._id}>Del</a>    
                                        </td>
                                    </tr>`);
                                    c++;
                     })
                    output=output.concat('</table>');
                    $('#product-table').html(output); 
             }        
            })
        })

     
        });
    </script>
</body>
</html>
